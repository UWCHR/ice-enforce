---
title: "ICE ERO-LESA nationwide removals data, FY12-22"
author: "UWCHR"
date: "2023-06-01"
output:
    html_document:
        html_preview: true
        toc: true
        toc_depth: 3
        toc_float: true
        code_folding: hide
---

# Data overview

This notebook presents a national overview of U.S. Immigration and Customs Enforcement (ICE) Enforcement and Removal Operations (ERO) Law Enforcement Systems and Analysis Division (LESA) data regarding nationwide ICE removals obtained by the University of Washington Center for Human Rights pursuant to FOIA request 2022-ICFO-09023. 

```{r setup, message=FALSE, warning=FALSE, include=TRUE}

options(scipen = 1000000)

library(pacman)

p_load(here, tidyverse, zoo, lubridate, ggplot2, plotly, gghighlight)

pd_dict <- read_delim(here('share', 'hand', 'processing_disp.csv'), delim='|')

rem <- read_delim(here('write', 'input', 'ice_removals_fy12-23ytd.csv.gz'), delim='|',
                  col_types = cols(aor = col_factor(),
                                   arrest_date = col_date(format="%m/%d/%Y"),
                                  departed_date = col_date(format="%m/%d/%Y"),
                                  case_close_date = col_date(format="%m/%d/%Y"),
                                  removal_date = col_date(format="%m/%d/%Y"),
                                  apprehension_method_code = col_character(),
                                  processing_disposition_code = col_factor(),
                                  citizenship_country = col_factor(),
                                  gender = col_factor(),
                                  final_charge_section = col_factor(),
                                  id = col_integer(),
                                  hashid = col_character()
                                  )) 

redacted <- c('removal_threat_level', 'alien_file_number')
redacted_text <- paste0('`', paste(unlist(redacted), collapse = '`, `'), '`')

rem <- rem %>% 
  dplyr::select(-redacted, -case_closed_date)

cy_months <- c("Jan","Feb","Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")
fy_months <- c("Oct", "Nov", "Dec", "Jan","Feb","Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep")

rem <- rem %>% 
  mutate(aor = factor(aor, levels = sort(levels(rem$aor))),
         year = year(departed_date),
         month = factor(month(departed_date, label=TRUE, abbr=TRUE), levels = fy_months),
         year_mth = zoo::as.yearmon(departed_date),
         processing_disp = toupper(coalesce(processing_disposition_code, processing_disposition)),
         fy =substr(quarter(departed_date, fiscal_start=10, type="year.quarter"), 1,4),
         gender = toupper(gender),
         processing_disposition = toupper(processing_disposition),
         citizenship_country = factor(toupper(citizenship_country))) %>% 
   filter(departed_date >= "2011-10-01",
         departed_date <= "2022-09-30")

rem <- left_join(rem, pd_dict, by=c('processing_disp' = 'processing_disposition_raw'))

```

A removal occurs when an individual is issued a final order of removal and departs the United States via deportation or voluntary return.[^1]

The removals dataset (`rem`) includes `r nrow(rem)` observations of `r length(rem)` variables; `r length(redacted)` fully redacted fields (`r redacted_text`) are dropped from analysis.

The following provides an summary of dataset characteristics via `skimr::skim(rem)`:

```{r skim, message=FALSE, warning=FALSE, include=TRUE}

skimr::skim(rem)

```

# Total removals

Major decrease in removals by ICE, but note CBP Title 42 expulsions at Southern border since 2020 are not counted here.

```{r fy_total, message=FALSE, warning=FALSE, include=TRUE}

p1 <- rem %>% 
  group_by(fy) %>% 
  summarize(n = n()) %>% 
  ggplot(aes(x = as.factor(fy), y=n)) +
  geom_col() +
  labs(title = "Total removals per FY")

p1

p2 <- rem %>%
  group_by(year_mth) %>%
  summarize(n = n()) %>%
  ggplot(aes(x = year_mth, y = n)) +
  geom_line(aes(group=1)) +
  ylim(0, NA) +
  labs(title = "Total nationwide ICE removals per month")

p2

p3 <- rem %>%
  group_by(fy, month) %>%
  summarize(n = n()) %>%
  ggplot(aes(x = month, y = n, color = fy, group = fy)) +
  geom_line() +
  ylim(0, NA) +
  scale_color_viridis_d() +
  labs(title = "Total nationwide ICE removals per month")

p3

```

# Basic demographics

## Gender

```{r gender, message=FALSE, warning=FALSE, include=TRUE}

# rem %>%
#   mutate(gender = tolower(gender)) %>% 
#   group_by(gender) %>% 
#   summarize(n = n())

p1 <- rem %>% 
  filter(departed_date >= "2011-10-01",
       departed_date <= "2022-09-30") %>% 
  count(fy, gender) %>% 
  ggplot(aes(x=fy, y=n, fill=gender)) +
  geom_col(position='fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(title="Total ICE removals, % by gender")

p1

```

## Country of citizenship

```{r cit, message=FALSE, warning=FALSE, include=TRUE}

cit <- rem %>%
  mutate(citizenship_country = toupper(citizenship_country)) %>% 
  group_by(citizenship_country) %>% 
  summarize(n = n()) %>% 
  arrange(desc(n))

p1 <- rem %>% 
  mutate(citizenship_country = case_when(
    citizenship_country %in% head(cit$citizenship_country, 15) ~ citizenship_country,
    TRUE ~ "ALL OTHERS"
  )) %>% 
  count(fy, citizenship_country) %>% 
  ggplot(aes(x=fy, y=n, fill=citizenship_country, color=citizenship_country)) +
  geom_col() +
  labs(title = "Total ICE removals by country of citizenship (top 15)")

ggplotly(p1)

# % change in removal by group?

```

# ICE removals per AOR

```{r removals_per_aor_fy, message=FALSE, warning=FALSE, include=TRUE}

p1 <- rem %>%  
  group_by(fy, aor) %>% 
  summarize(n = n()) %>% 
  ggplot(aes(x = as.factor(fy), y=n, color=aor, group=aor)) +
  geom_line() +
  labs(title = "Total removals per FY by AOR")

ggplotly(p1)

```


```{r removals_pct_chg, message=FALSE, warning=FALSE, include=TRUE}

natl_pct_chg <- rem %>%
  filter(departed_date >= "2011-10-01",
         departed_date <= "2022-09-30") %>% 
  group_by(fy) %>%
  summarize(n = n()) %>% 
  mutate(pct_change = (n/lag(n) - 1))

p1 <- natl_pct_chg %>% 
  ggplot(aes(x = fy, y = pct_change)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  labs(title="FY % change in total removals")

p1

aor_pct_chg <- rem %>%
  filter(departed_date >= "2011-10-01",
         departed_date <= "2022-09-30",
         aor != "HQ",
         !is.na(aor)) %>% 
  group_by(fy, aor) %>%
  summarize(n = n()) %>% 
  group_by(aor) %>% 
  arrange(fy, .by_group=TRUE) %>% 
  mutate(pct_change = (n/lag(n) - 1))

p2 <- aor_pct_chg %>% 
  ggplot(aes(x = fy, y = pct_change)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  scale_x_discrete(breaks=seq(2012, 2022, 2)) +
  facet_wrap(~aor)  +
  labs(title="FY % change in total removals per AOR") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

p2

```

# Processing disposition

```{r disp, message=FALSE, warning=FALSE, include=TRUE}

disps <- rem %>% 
  filter(departed_date >= "2012-10-01",
         departed_date <= "2022-09-30",
         ) %>% 
  count(processing_disposition_clean) %>% 
  arrange(desc(n))

top_disp <- disps %>% 
  filter(n > 50000)

rem <- rem %>% 
  mutate(disp_short = case_when(processing_disposition_clean %in% unlist(top_disp$processing_disposition_clean) ~ as.character(processing_disposition_clean), 
                                         TRUE ~ "ALL OTHERS"))


```

```{r rem_disp_fy, message=FALSE, warning=FALSE, include=TRUE}

p1 <- rem %>% 
  filter(departed_date >= "2012-10-01",
         departed_date <= "2022-09-30",
         ) %>% 
  group_by(fy, disp_short) %>% 
  summarize(n = n()) %>% 
  ggplot(aes(x = as.factor(fy), y=n, fill=disp_short)) +
  geom_col() +
  labs(title = "Total removals per FY by processing disposition")

ggplotly(p1)

```

# Dates

Removals data includes four separate date fields: `departed_date`, `case_close_date`, `arrest_date`, and `removal_date`. Of these, `departed_date` is most complete, with no missing values; therefore we use this date as the primary field for date values in this notebook.

```{r date_compare, message=FALSE, warning=FALSE, include=TRUE}

rem %>% 
  dplyr::select(contains('date')) %>% 
skimr::skim()

hist(rem$departed_date, breaks='years', col='pink')
hist(rem$removal_date, breaks='years', col='lightblue')
hist(rem$arrest_date, breaks='years', col='lightyellow')
hist(rem$case_close_date, breaks='years', col='lightgreen')

```

The earliest dataset analyzed here, for FY 2012, includes only the `departed_date` and `case_close_date` fields; the FY 2013 dataset introduces an additional `arrest_date` value alongside these; and the FY 2014 and subsequent datasets include a fourth value for `removal_date`.

The fields `departed_date` and `removal_date` are complete for all records in datasets where these date fields appear. Only the most recent records for FY 2022 are missing `case_close_date` values, logically suggests that these cases remained open at the time of production of this dataset; a small proportion of records are missing `arrest_date` during all years since FY 2013, it is not clear what this indicates about the cases in question.

```{r date_compare_fy, message=FALSE, warning=FALSE, include=TRUE}

rem %>% 
  group_by(fy) %>% 
  summarize(missing_dep_date = sum(is.na(departed_date)),
            missing_rem_date = sum(is.na(removal_date)),
            missing_arr_date = sum(is.na(arrest_date)),
            missing_cc_date = sum(is.na(case_close_date)),
            )

```

We can calculate lag between different dates, between arrest date and departure date, which reveals an increase in average time between arrest and departure since FY 2014; and significant difference between cases by `processing_disposition`:

```{r dep_diff_arr, message=FALSE, warning=FALSE, include=TRUE}

rem$dep_diff_arr <- difftime(rem$departed_date, rem$arrest_date, units='days')

rem %>% 
  filter(fy >= 2014) %>% 
  group_by(fy) %>% 
  summarize(mean_dep_diff_arr = mean(dep_diff_arr, na.rm = TRUE)) %>% 
  ggplot(aes(x = fy, y = mean_dep_diff_arr)) +
  geom_line(group=1) +
  ylim(0, NA)

rem %>% 
  mutate(disp_short = case_when(processing_disposition_clean %in% unlist(top_disp$processing_disposition_clean) ~ as.character(processing_disposition_clean), 
                                         TRUE ~ "ALL OTHERS")) %>% 
  filter(fy >= 2014) %>% 
  group_by(disp_short) %>% 
  summarize(mean_dep_diff_arr = mean(dep_diff_arr, na.rm = TRUE),
            med_dep_diff_arr = median(dep_diff_arr, na.rm = TRUE))

```


[^1]: For discussion of ICE's definition of "removals", see American Immigration Council, "Changing Patterns of Interior Immigration Enforcement in the United States, 2016 - 2018", July 2019: https://www.americanimmigrationcouncil.org/research/interior-immigration-enforcement-united-states-2016-2018
