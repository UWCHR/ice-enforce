---
title: "FY12-23YTD ICE ERO arrests descriptive analysis"
author: "UWCHR"
date: "2023-03-27"
output:
    html_document:
        html_preview: true
        toc: true
        toc_depth: 3
        toc_float: true
        code_folding: hide
---

# ICE ERO arrests: Data overview

```{r setup, echo=FALSE, message=FALSE, warning=FALSE, include=TRUE}

library(pacman)

p_load(here, tidyverse, zoo, lubridate, ggplot2, plotly, gghighlight)

arr <- read_delim(here('us-fy12-23', 'analyze', 'input', 'ice_arrests_fy12-23ytd.csv.gz'), delim='|',
                  col_types = cols(aor = col_factor(),
                                  arrest_date = col_date(format="%m/%d/%Y"),
                                  departed_date = col_date(format="%m/%d/%Y"),
                                  apprehension_landmark = col_factor(),
                                  arrest_method = col_factor(),
                                  operation = col_factor(),
                                  processing_disposition = col_factor(),
                                  citizenship_country = col_factor(),
                                  gender = col_factor(),
                                  case_closed_date = col_date(format="%m/%d/%Y"),
                                  id = col_integer(),
                                  hashid = col_character()
                                  )) 

redacted <- c('removal_threat_level', 'apprehension_threat_level', 'alien_file_number')

arr <- arr %>% 
  dplyr::select(-all_of(redacted))

arr <- arr %>% 
  mutate(arrest_date = as_date(arrest_date, format="%m/%d/%Y"),
         year = year(arrest_date),
         month = month(arrest_date, label=TRUE, abbr=TRUE),
         year_mth = zoo::as.yearmon(arrest_date),
         fy = as.factor(substr(quarter(arrest_date, fiscal_start=10, type="year.quarter"), 1,4)),
         citizenship_country = as.factor(toupper(citizenship_country)))

# skimr::skim(arr)

```

# Total arrests by FY

```{r fy_total, echo=FALSE, message=FALSE, include=TRUE}

p1 <- arr %>% 
  filter(arrest_date <= "2022-09-30") %>% 
  group_by(fy) %>% 
  summarize(n = n()) %>% 
  ggplot(aes(x = as.factor(fy), y=n)) +
  geom_col() +
  labs(title = "Total ICE arrests per FY")

p1

```

# Basic demographics

Increasing proportion of females arrested since FY 2021:
 
```{r gender, echo=FALSE, message=FALSE, warning=FALSE, include=TRUE}

# arr %>%
#   mutate(gender = toupper(gender)) %>% 
#   group_by(gender) %>% 
#   summarize(n = n())

p1 <- arr %>% 
  filter(arrest_date <= "2022-09-30") %>%
  count(fy, gender) %>% 
  ggplot(aes(x=fy, y=n, fill=gender)) +
  geom_col(position='fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(title="Total ICE arrests, % by gender")

p1

```

Changing composition of arrest nationality: Mexico, Guatemala, El Salvador decrease as proportion; absolute increase in Venezeula, Colombia, Nicaragua.

```{r cit, echo=FALSE, message=FALSE, include=TRUE}

cit <- arr %>%
  filter(arrest_date <= "2022-09-30") %>% 
  mutate(citizenship_country = toupper(citizenship_country)) %>% 
  group_by(citizenship_country) %>% 
  summarize(n = n()) %>% 
  arrange(desc(n))

p1 <- arr %>% 
  filter(arrest_date <= "2022-09-30") %>%
  mutate(citizenship_country = case_when(
    citizenship_country %in% head(cit$citizenship_country, 15) ~ citizenship_country,
    TRUE ~ "all others"
  )) %>% 
  count(fy, citizenship_country) %>% 
  ggplot(aes(x=fy, y=n, fill=citizenship_country)) +
  geom_col() +
  labs(title = "Total ICE arrests by country of citizenship (top 15)")

p1

```


```{r cit_rank, echo=FALSE, message=FALSE, include=TRUE}

cit_rank <- arr %>% 
  filter(arrest_date <= "2022-09-30") %>% 
  count(fy, citizenship_country) %>% 
  arrange(fy, desc(n), citizenship_country) %>% 
  group_by(fy) %>% 
  mutate(ranking = row_number())

p1 <- cit_rank %>% 
  filter(ranking <= 10) %>% 
  ggplot(aes(x = fy, y = ranking, group = citizenship_country)) +
  geom_line(aes(color = citizenship_country, alpha = 1), size = 1) +
  geom_point(aes(color = citizenship_country, alpha = 1), size = 2) +
  scale_y_reverse() +
  labs(title = "Ranked country of citizenship for ICE arrests")

ggplotly(p1)

```

# Total arrests by AOR

Below is an interactive chart of total ICE arrests per FY by AOR:

```{r annual, echo=FALSE, message=FALSE, include=TRUE}

p1 <- arr %>% 
  filter(arrest_date <= "2022-09-30") %>% 
  group_by(fy, aor) %>% 
  summarize(n = n()) %>% 
  ggplot(aes(x = as.factor(fy), y=n, color=aor, group=aor)) +
  geom_line() +
  labs(title = "Total ICE arrests per FY by AOR")

ggplotly(p1)

```

Below is a chart of total ICE arrests per FY, highlighting the Seattle AOR ("SEA"):

```{r annual_sea, message=FALSE, warning=FALSE}


p2 <- arr %>% 
  filter(arrest_date <= "2022-09-30") %>% 
  group_by(fy, aor) %>% 
  summarize(n = n()) %>% 
  ggplot(aes(x = as.factor(fy), y=n, color=aor, group=aor)) +
  geom_line() +
  gghighlight(aor == "SEA") +
  labs(title = "Total ICE arrests per FY",
       subtitle = "Seattle AOR highlighted")

p2

```

# Percent change

Percent change in arrests per FY nationally and by AOR. Note comparison between groups may be misleading because smaller population AORs will be more volatile.

```{r arrests_pct_chg, message=FALSE, warning=FALSE}

natl_pct_chg <- arr %>%
  filter(arrest_date <= "2022-09-30") %>% 
  group_by(fy) %>%
  summarize(n = n()) %>% 
  mutate(pct_change = (n/lag(n) - 1))

p1 <- natl_pct_chg %>% 
  ggplot(aes(x = fy, y = pct_change)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  labs(title="FY % change in total ICE arrests")

p1

aor_pct_chg <- arr %>%
  filter(arrest_date <= "2022-09-30",
         !is.na(aor)) %>% 
  group_by(fy, aor) %>%
  summarize(n = n()) %>% 
  group_by(aor) %>% 
  arrange(fy, .by_group=TRUE) %>% 
  mutate(pct_change = (n/lag(n) - 1))

p2 <- aor_pct_chg %>% 
  ggplot(aes(x = fy, y = pct_change)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  scale_x_discrete(breaks=seq(2012, 2022, 2)) +
  facet_wrap(~aor)  +
  labs(title="FY % change in total ICE arrests per AOR") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

p2

# Could try superimposing line chart of total arrests as above

specific_aor_pct_chg <- aor_pct_chg %>% 
  filter(aor == "SEA") %>% 
  rename(group = aor) %>% 
  dplyr::select(fy, group, n, pct_change)

natl_pct_chg$group = "Natl"

natl_pct_chg <- natl_pct_chg %>% 
  dplyr::select(fy, group, n, pct_change)

dat <- rbind(natl_pct_chg, specific_aor_pct_chg)

p3 <- dat %>% 
  ggplot() +
  geom_col(aes(x = fy, y = pct_change, fill=group, group=group), position='dodge')

p3

```


```{r arrests_pct_chg_method, message=FALSE, warning=FALSE}

method_str <- "CAP Local Incarceration"
specific_aor <- "SEA"

natl_pct_chg_method <- arr %>%
  filter(arrest_date <= "2022-09-30",
         str_detect(arrest_method, method_str)) %>% 
  group_by(fy) %>%
  summarize(n = n()) %>% 
  mutate(pct_change = (n/lag(n) - 1),
         group='Natl') %>% 
  dplyr::select(fy, group, n, pct_change)

aor_pct_chg_method <- arr %>%
  filter(arrest_date <= "2022-09-30",
         str_detect(arrest_method, method_str),
         !is.na(aor)) %>% 
  group_by(fy, aor) %>%
  summarize(n = n()) %>% 
  group_by(aor) %>% 
  arrange(fy, .by_group=TRUE) %>% 
  mutate(pct_change = (n/lag(n) - 1)) %>% 
  rename(group = aor) %>% 
  dplyr::select(fy, group, n, pct_change)


# Could try superimposing line chart of total arrests as above

specific_aor_pct_chg_method <- aor_pct_chg_method %>% 
  filter(group == specific_aor)

dat <- rbind(natl_pct_chg_method, specific_aor_pct_chg_method)

p3 <- dat %>% 
  ggplot() +
  geom_col(aes(x = fy, y = pct_change, fill=group, group=group), position='dodge') +
  scale_y_continuous(labels = scales::percent) +
  labs(title = paste0("Annual % change ", '"', method_str, '"', " arrests"),
       subtitle = paste0(specific_aor, " vs. National"))

p3

```


# Arrests by `arrest_method`

```{r method_setup, echo=FALSE, message=FALSE, include=TRUE}

methods <- arr %>% 
  count(arrest_method) %>% 
  arrange(desc(n))

top_methods <- methods %>% 
  filter(n > 5000)

arr <- arr %>% 
  mutate(arrest_method_short = case_when(arrest_method %in% unlist(top_methods$arrest_method) ~ as.character(arrest_method), 
                                         TRUE ~ "All others"))

```

Arrests trend down nationwide; slight bump up during Trump admin; big bump of NCA in 2022 (as ICE processed people initially encountered at southern border by BP?). Global decline CLC; NCA now >50% of arrests--but are these at-large community arrests or self-report? Look at trends in `processing_disposition`, `operation`, `apprehension_landmark`.

```{r national_arrest_method, message=FALSE, warning=FALSE}

p1 <- arr %>% 
  filter(arrest_date <= "2022-09-30") %>% 
  group_by(fy, arrest_method_short) %>%
  ggplot(aes(x = fy, fill=arrest_method_short)) +
  geom_bar(stat='count', position='stack')

ggplotly(p1)

```

```{r arr_method_pct_chg, message=FALSE, warning=FALSE}

method_pct_chg <- arr %>%
  filter(arrest_date <= "2022-09-30",
         !is.na(aor)) %>% 
  group_by(fy, arrest_method_short) %>%
  summarize(n = n()) %>% 
  group_by(arrest_method_short) %>% 
  arrange(fy, .by_group=TRUE) %>% 
  mutate(pct_change = (n/lag(n) - 1))

p1 <- method_pct_chg %>% 
  ggplot(aes(x = fy, y = pct_change)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  scale_x_discrete(breaks=seq(2012, 2022, 2)) +
  facet_wrap(~arrest_method_short, scales='free_y')  +
  labs(title="FY % change in total ICE arrests by arrest method") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

p1

```

```{r method_per_aor, message=FALSE, warning=FALSE}

p2 <- arr %>% 
  filter(!is.na(aor),
         aor != "HQ") %>% 
  group_by(aor, fy, arrest_method_short) %>%
  ggplot(aes(x = fy, fill=arrest_method_short)) +
  geom_bar(stat='count') +
  scale_x_discrete(breaks=seq(2012, 2022, 2)) +
  facet_wrap(~aor) +
  labs(title="Total ICE arrests by arrest method per AOR") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0, hjust=1))

ggplotly(p2)


```

```{r arrest_method_sex}

p1 <- arr %>% 
  filter(arrest_date <= "2022-09-30") %>%
  count(fy, gender, arrest_method_short) %>% 
  ggplot(aes(x=fy, y=n, fill=gender)) +
  geom_col(position='fill') +
  facet_wrap(~arrest_method_short) +
  scale_y_continuous(labels = scales::percent) +
  labs(title="Total ICE arrests, % by gender")

p1

```

# SEA arrest methods

Overview of arrest methods for Seattle Area of Responsiblity:

```{r trend_specific_aor, message=FALSE, warning=FALSE}

specific_aor = "SEA"

p4 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date >= '2016-10-01') %>%
  group_by(aor, year_mth, arrest_method_short) %>%
  summarize(n = n()) %>% 
  ggplot(aes(x = year_mth, y = n, fill=arrest_method_short, group=arrest_method_short)) +
  geom_col() +
  labs(title=paste0("Total arrests by arrest method, ", specific_aor, " AOR"))

ggplotly(p4)

```

## Trends in SEA NCA arrests

```{r sea_arr_method_pct_chg, message=FALSE, warning=FALSE}

method_pct_chg <- arr %>%
  filter(arrest_date <= "2022-09-30",
         aor == specific_aor,
         !is.na(aor)) %>% 
  group_by(fy, arrest_method_short) %>%
  summarize(n = n()) %>% 
  group_by(arrest_method_short) %>% 
  arrange(fy, .by_group=TRUE) %>% 
  mutate(pct_change = (n/lag(n) - 1))

p1 <- method_pct_chg %>% 
  ggplot(aes(x = fy, y = pct_change)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  scale_x_discrete(breaks=seq(2012, 2022, 2)) +
  facet_wrap(~arrest_method_short, scales='free_y')  +
  labs(title="FY % change in total ICE arrests by arrest method",
       subtitle=paste0(specific_aor, " AOR")) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

p1

```

Significant increase in non-custodial arrests, similar to national trends:

```{r trend_specific_aor_method_nca, message=FALSE, warning=FALSE}

specific_aor = "SEA"
specific_method = "Non-Custodial Arrest"

p4 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  group_by(aor, year_mth, arrest_method_short) %>%
  summarize(n = n()) %>% 
  ggplot(aes(x = year_mth, y = n, fill=arrest_method_short, group=arrest_method_short)) +
  geom_col() +
  geom_vline(aes(xintercept=as.yearmon("2019-06"))) +
  geom_text(aes(x=as.yearmon("2019-06"), y=max(n * .9), label="\nKWW"), color='black', angle='90', text=element_text(size=8), check_overlap = TRUE) +
  geom_vline(aes(xintercept=as.yearmon("2021-11"))) +
  geom_text(aes(x=as.yearmon("2021-11"), y=max(n * .9), label="\nSPA"), color='black', angle='90', text=element_text(size=8), check_overlap = TRUE) +
  labs(title = "Total ICE arrests",
       subtitle = paste(specific_method, specific_aor, sep=", "))

p4

```

```{r trend_compare_method_nca_highlight_aor, message=FALSE, warning=FALSE}

p1 <- arr %>% 
  filter(!is.na(aor),
         arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  count(aor, year_mth, arrest_method_short) %>%
  ggplot(aes(x = year_mth, y = n, color=aor, group=aor)) +
  geom_line() +
  gghighlight(aor == specific_aor) +
  labs(title = "Total ICE arrests per AOR",
       subtitle = paste(specific_method))

p1

```

Most people involved in non-custodial arrests served w/ warrant or NTA; decreasing proportion of reinstatement of deportation:

```{r sea_nca}

p1 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  count(aor, year_mth, processing_disposition) %>%
  ggplot(aes(x = year_mth, y = n, fill=processing_disposition, group=processing_disposition)) +
  geom_col() +
  labs(title = paste("Processing disposition,", specific_method, specific_aor))

ggplotly(p1)

```

Landmarks for "non-custodial arrests" often reflect operational nature of arrest, not location. Recent increase largely "Seattle Non-Detained Docket" and other non-detained categories, compared to categories which suggest street/fugitive operations arrests. Should compare to other non-custodial categories (i.e. "Located").

```{r sea_nca_landmark, message=FALSE, warning=FALSE}

sea_nca_landmarks <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         # arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  count(aor, apprehension_landmark) %>% 
  arrange(desc(n))

p2 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date > '2016-09-30',
         arrest_method_short == specific_method) %>%
  mutate(apprehension_landmark = case_when(
    apprehension_landmark %in% head(sea_nca_landmarks$apprehension_landmark, 10) ~ apprehension_landmark,
    TRUE ~ "ALL OTHERS")) %>%
  count(year_mth, apprehension_landmark) %>% 
  ggplot(aes(x=year_mth, y=n, fill=apprehension_landmark, group=apprehension_landmark)) +
  geom_col()

ggplotly(p2)

```

```{r zoom_sea_nca, inclde=FALSE, message=FALSE, warning=FALSE}

dat <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date > '2020-09-30',
         arrest_method_short == specific_method)

top_temp <- dat %>% count(apprehension_landmark) %>% 
  arrange(desc(n))

p2 <- dat %>%
  mutate(apprehension_landmark = case_when(apprehension_landmark %in% head(top_temp$apprehension_landmark, 10) ~ apprehension_landmark,
                                           TRUE ~ "ALL OTHERS")) %>%
  count(year_mth, apprehension_landmark) %>% 
  ggplot(aes(x=year_mth, y=n, fill=apprehension_landmark, group=apprehension_landmark)) +
  geom_col()

ggplotly(p2)

```

Most NCA arrests missing `operation` data but for those that do recent arrests largely associated with "Southwest Border SWB PD".

```{r sea_nca_ops, message=FALSE, warning=FALSE}

sea_nca_operations <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  count(aor, operation) %>% 
  arrange(desc(n))

p3 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  mutate(operation = case_when(operation %in% head(sea_nca_operations$operation, 10) ~ operation,
                                           TRUE ~ "ALL OTHERS")) %>% 
  count(year_mth, operation) %>% 
  ggplot(aes(x=year_mth, y=n, fill=operation, group=operation)) +
  geom_col()

ggplotly(p3)

```

## Trends in SEA CLC arrests

Criminal Alien Program (CAP) Local Incarceration arrests declined through latter Obama admin, rebounded during Trump, declined precipitously during COVID, have not returned to pre-COVID level in SEA:

```{r trend_specific_aor_method_clc, message=FALSE, warning=FALSE}

specific_aor = "SEA"
specific_method = "CAP Local Incarceration"

p4 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date >= '2016-09-30',
         arrest_method_short == specific_method) %>%
  group_by(aor, year_mth, arrest_method_short) %>%
  summarize(n = n()) %>% 
  ggplot(aes(x = year_mth, y = n, fill=arrest_method_short, group=arrest_method_short)) +
  geom_col() +
  geom_vline(aes(xintercept=as.yearmon("2019-06"))) +
  geom_vline(aes(xintercept=as.yearmon("2021-11"))) +
  labs(title = "Total ICE arrests",
       subtitle = paste(specific_method, specific_aor, sep=", "))

p4

```

```{r trend_compare_method_clc_highlight_aor, message=FALSE, warning=FALSE}

p1 <- arr %>% 
  filter(!is.na(aor),
         # arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  count(aor, year_mth, arrest_method_short) %>%
  ggplot(aes(x = year_mth, y = n, color=aor, group=aor)) +
  geom_line() +
  gghighlight(aor == specific_aor) +
  labs(title = "Total ICE arrests per AOR",
       subtitle = paste(specific_method))

p1

```

```{r sea_cap, message=FALSE, warning=FALSE}

p1 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  count(aor, year_mth, processing_disposition) %>%
  ggplot(aes(x = year_mth, y = n, fill=processing_disposition, group=processing_disposition)) +
  geom_col() +
  labs(title = paste("Processing disposition,", specific_method, specific_aor))

ggplotly(p1)

```

Landmarks reflect both operational nature of arrest and potential location, including specific incarceration locations:

```{r sea_cap_landmark, message=FALSE, warning=FALSE}

sea_cap_landmarks <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         # arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  count(aor, apprehension_landmark) %>% 
  arrange(desc(n))

p2 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date > '2016-09-30',
         arrest_method_short == specific_method) %>%
  # mutate(apprehension_landmark = case_when(apprehension_landmark %in% head(sea_nca_landmarks$apprehension_landmark, 10) ~ apprehension_landmark,
  #                                          TRUE ~ "ALL OTHERS")) %>% 
  count(year_mth, apprehension_landmark) %>% 
  ggplot(aes(x=year_mth, y=n, fill=apprehension_landmark, group=apprehension_landmark)) +
  geom_col() +
  theme(legend.position = "none") +
  labs(title = "CLC arrest location (all)")

ggplotly(p2)

```

Zooming in on recent CLC arrests. Note several state and federal correctional instutions included in this category (erroneously); other values do not appear to suggest incarceration ("Non-Detained"):

```{r zoom_sea_cap, message=FALSE, warning=FALSE}

p2 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date > '2021-09-30',
         arrest_method_short == specific_method) %>%
  # mutate(apprehension_landmark = case_when(apprehension_landmark %in% head(sea_nca_landmarks$apprehension_landmark, 10) ~ apprehension_landmark,
  #                                          TRUE ~ "ALL OTHERS")) %>% 
  count(year_mth, apprehension_landmark) %>% 
  ggplot(aes(x=year_mth, y=n, fill=apprehension_landmark, group=apprehension_landmark)) +
  geom_col()

ggplotly(p2)

```

Vast majority of CLC arrests missing `operation` data:

```{r sea_cap_ops, message=FALSE, warning=FALSE}

sea_cap_operations <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  count(aor, operation) %>% 
  arrange(desc(n))

p3 <- arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date >= '2016-10-01',
         arrest_method_short == specific_method) %>%
  mutate(operation = case_when(operation %in% head(sea_nca_operations$operation, 10) ~ operation,
                                           TRUE ~ "ALL OTHERS")) %>% 
  count(year_mth, operation) %>% 
  ggplot(aes(x=year_mth, y=n, fill=operation, group=operation)) +
  geom_col()

ggplotly(p3)

```

```{r tab_sea_cap, include=FALSE, message=FALSE, warning=FALSE}

arr %>% 
  filter(!is.na(aor),
         aor == specific_aor,
         arrest_date > '2021-09-30',
         arrest_method_short == specific_method) %>%
  # mutate(apprehension_landmark = case_when(apprehension_landmark %in% head(sea_nca_landmarks$apprehension_landmark, 10) ~ apprehension_landmark,
  #                                          TRUE ~ "ALL OTHERS")) %>% 
  count(year_mth, apprehension_landmark)

```
